<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lims resultaten ophalen • inbolims</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Lims resultaten ophalen">
<meta property="og:description" content="inbolims">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">inbolims</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reading_lims_results.html">Lims resultaten ophalen</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inbo/inbolims/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lims resultaten ophalen</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/inbo/inbolims/blob/HEAD/vignettes/reading_lims_results.Rmd" class="external-link"><code>vignettes/reading_lims_results.Rmd</code></a></small>
      <div class="hidden name"><code>reading_lims_results.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="beschrijving">Beschrijving<a class="anchor" aria-label="anchor" href="#beschrijving"></a>
</h2>
<p>Deze vignette omvat de instructies om de in het LIMS bewaarde
resultaten op te halen in R. Dit werkt enkel binnen het netwerk van het
INBO of indien verbonden via vpn met het netwerk.</p>
</div>
<div class="section level2">
<h2 id="gegevens-uit-het-lims-datawarehouse-halen">Gegevens uit het LIMS Datawarehouse halen<a class="anchor" aria-label="anchor" href="#gegevens-uit-het-lims-datawarehouse-halen"></a>
</h2>
<div class="section level3">
<h3 id="eerste-gebruik">Eerste gebruik<a class="anchor" aria-label="anchor" href="#eerste-gebruik"></a>
</h3>
<p>Indien het pakket nog nooit gebruikt is moet je het installeren via
github met volgende code:</p>
<pre><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"inbo/inbolims"</span><span class="op">)</span></span></code></pre>
<p>Ook als je het pakket lang niet meer gebruikt hebt kan het handig
zijn deze bovenstaande code opnieuw te laten lopen zodat package updates
geïnstalleerd worden.</p>
</div>
<div class="section level3">
<h3 id="gewone-gebruik">Gewone gebruik<a class="anchor" aria-label="anchor" href="#gewone-gebruik"></a>
</h3>
<p>Iedere keer R opnieuw opgestart wordt zal je de inbolims library
moeten laden</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/inbo/inbolims" class="external-link">inbolims</a></span><span class="op">)</span></span></code></pre></div>
<p>De belangrijkste functionaliteit in het script is de connectie met de
databank en het ophalen van gegevens van een project. Dit doe je als
volgt:</p>
<pre><code><span><span class="co">#maak connectie met databank</span></span>
<span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lims_connect.html">lims_connect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#haal de rapportgegevens binnen uit de databank</span></span>
<span><span class="va">rapport_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_lims_data.html">read_lims_data</a></span><span class="op">(</span>connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>                               project <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I-19W001-02"</span><span class="op">)</span>,</span>
<span>                               sql_template <span class="op">=</span> <span class="st">"default"</span><span class="op">)</span></span></code></pre>
<p>Bovenstaande code haalt de data op voor het project I-19W001-02
(project = “I-19W001-02”) volgens de standaardtemplate (template =
“default”). Als eerste variabele moet de databank connectie opgegeven
worden, zodat de routine weet waar de gegevens uit gehaald moeten
worden.</p>
<p>De beschikbare templates en geïmporteerde velden kan je terugvinden
via volgende functies:</p>
<pre><code><span><span class="fu"><a href="../reference/show_available_templates.html">show_available_templates</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_report_config_info.html">get_report_config_info</a></span><span class="op">(</span>template<span class="op">=</span><span class="st">"default"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="afgeleide-routines-work-in-progress">Afgeleide routines (work in progress)<a class="anchor" aria-label="anchor" href="#afgeleide-routines-work-in-progress"></a>
</h3>
<div class="section level4">
<h4 id="staaloverzicht">Staaloverzicht<a class="anchor" aria-label="anchor" href="#staaloverzicht"></a>
</h4>
<p>Om een overzicht van de stalen te hebben van de ingelezen
rapport_data.</p>
<pre><code><span><span class="va">staaloverzicht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lims_report_samples.html">lims_report_samples</a></span><span class="op">(</span><span class="va">rapport_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">staaloverzicht</span><span class="op">)</span></span></code></pre>
<p>Op dit moment vereist bovenstaande routine nog heel wat velden,
daarom dat dit enkel gegarandeerd is te werken met de <em>default</em>
<code>sql_template</code>.</p>
</div>
<div class="section level4">
<h4 id="kruistabel">Kruistabel<a class="anchor" aria-label="anchor" href="#kruistabel"></a>
</h4>
<p>Het formaat van <code>rapport_data</code> is in een lang dataformaat,
waarbij ieder resultaat op een andere regel staat. Vaak is eerder
gewenst de resultaten van een staal naast elkaar te zien:</p>
<pre><code><span><span class="va">kruistabel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lims_report_xtab.html">lims_report_xtab</a></span><span class="op">(</span><span class="va">rapport_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kruistabel</span><span class="op">)</span></span></code></pre>
<p>Let hierbij wel op het gebruik, want informatie rond het al dan niet
rond de detectielimiet te liggen verdwijnt in dit formaat.</p>
</div>
<div class="section level4">
<h4 id="exporteren">Exporteren<a class="anchor" aria-label="anchor" href="#exporteren"></a>
</h4>
<p>Bovenstaande kruistabel kan je gemakkelijk naar een door excel
leesbaar csv bestand converteren:</p>
<pre><code><span><span class="fu"><a href="../reference/lims_report_export.html">lims_report_export</a></span><span class="op">(</span><span class="va">kruistabel</span>, path <span class="op">=</span> <span class="st">"test_xtab.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/lims_report_export.html">lims_report_export</a></span><span class="op">(</span><span class="va">rapport_data</span>, path <span class="op">=</span> <span class="st">"test.csv"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="geavanceerde-datafuncties">Geavanceerde datafuncties<a class="anchor" aria-label="anchor" href="#geavanceerde-datafuncties"></a>
</h2>
<div class="section level3">
<h3 id="volledige-query-tonen">Volledige query tonen<a class="anchor" aria-label="anchor" href="#volledige-query-tonen"></a>
</h3>
<p>Via het argument <code>show_query = TRUE</code> kan je de volledige
query zien waarmee de data bevraagd is. Deze query kan je dan gebruiken
als basis om je data volledig gecustomiseerd binnen te halen.</p>
<pre><code><span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lims_connect.html">lims_connect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rapport_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_lims_data.html">read_lims_data</a></span><span class="op">(</span>connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>                               project <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I-19W001-02"</span><span class="op">)</span>,</span>
<span>                               sql_template <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>                               show_query <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>                               </span></code></pre>
<p>Dit is bijvoorbeeld de query die erachter zit op 23 november
2023.</p>
<pre><code>select  ContractID = c.[Contract],
Klant = r.[Customer],
Project = r.[Project],
VerantwoordelijkLabo = p.[ResponsibleLab],
LimsStaalNummer = s.[LIMSSampleNumber],
ExternSampleID = s.[FieldSampleID],
LaboCode = s.[LabSampleID],
OrigineelStaal = s.[LIMSOriginalSampleNumber],
SampleProduct = s.[Product],
ProductGrade = s.[MatrixDetail],
SamplingPoint = s.[SamplingPoint],
Matrix = s.[Matrix],
Monsternamedatum = s.[FieldSamplingDate],
Monsternemer = s.[FieldObserver],
Toestand = s.[SampleCondition],
VoorbehandelingExtern = s.[SamplePreparation],
Opmerking = s.[FieldSampleRemark],
LimsAnalyseNaam = r.[LimsAnalysisName],
LimsAnalyseVersie = a.[AnalysisVersion],
SapCode = a.[SAPcode],
AnalyseNaam = a.[AnalysisLabName],
Component = r.[Component],
Gerapporteerd = r.[IsReportable],
TestReplicaat = r.[TestReplicateCount],
ResultaatReplicaat = r.[ResultReplicate],
ResultaatInstrument = r.[Instrument],
Batch = r.[Batch],
ResultaatType = r.[ResultType],
Eenheid = u.[Unit],
WaardeRuw = r.[Result],
WaardeGeformatteerd = r.[ResultFormatted],
WaardeNumeriek = r.[ResultNumeric],
WaardeNumeriekGeformatteerd = r.[ResultFormattedNumeric],
BenedenLOQ = r.[isBelowLOQ],
VisueleMatrix = s.[VisualMatrix],
Plaat = s.[samplePlate],
PlaatPositie = s.[SamplePlatePosition],
ArchiefStaal = s.[IsArchiveSample],
Xcoord = s.[SampleLambertX],
Ycoord = s.[SampleLambertY],
Diepte = s.[SampleDepth],
Toponiem = s.[SampleToponym],
StaalStatus = s.[SampleStatus],
ResultaatStatus = r.[ResultStatus],
BatchInstrument = b.[BatchInstrument] from  dimSample s 
left join factResult r on r.SampleKey = s.SampleKey 
inner join dimProject p on r.ProjectKey = p.ProjectKey 
inner join dimContract c on r.ContractKey = c.ContractKey 
inner join dimAnalysis a on r.AnalysisKey = a.AnalysisKey 
left join dimUnit u on r.UnitKey = u.UnitKey 
left join dimBatch b on r.BatchKey = b.BatchKey where  r.Project in ('I-19W001-02') AND 
s.SampleStatus = 'A' AND 
r.ResultStatus= 'A' AND 
p.ProjectStatus = 'V' AND 
r.IsReportable=1</code></pre>
<p>Deze query kan je dan gebruiken om een klassieke databankbevraging te
doen als volgt:</p>
<pre><code><span><span class="va">rapport_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">connection</span>, <span class="va">querynaam</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="standaard-templates">Standaard templates<a class="anchor" aria-label="anchor" href="#standaard-templates"></a>
</h3>
<p>Er worden ook enkele templates voorzien om te selecteren welke velden
je wil ophalen in de data, dan zullen enkel deze velden, alsook enkele
verplichte velden opgehaald worden.</p>
<pre><code><span><span class="va">rapport_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_lims_data.html">read_lims_data</a></span><span class="op">(</span>connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>                               project <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I-19W001-02"</span><span class="op">)</span>,</span>
<span>                               sql_template <span class="op">=</span> <span class="st">"minimal"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="basisstatistieken">Basisstatistieken<a class="anchor" aria-label="anchor" href="#basisstatistieken"></a>
</h2>
<p>Je kan heel rudimentair een overzicht en overzichtsplot opvragen van
de data. Indien je geen plot wenst kan je <code>plot = NULL</code>
zetten</p>
<pre><code><span><span class="va">statistieken</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lims_result_statistics.html">lims_result_statistics</a></span><span class="op">(</span><span class="va">rapport_data</span>, plot <span class="op">=</span> <span class="st">"boxplot"</span><span class="op">)</span></span>
<span><span class="va">statistieken</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Pieter Verschelde.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
