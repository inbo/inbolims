---
title: "Lims resultaten ophalen"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Lims resultaten ophalen}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Beschrijving

R scripts om de in LIMS bewaarde gegevens van het INBO op te halen. Dit werkt enkel binnen het netwerk van het instituut of indien verbonden via vpn met het netwerk.

Voorlopig zijn er 3 hoofdbrokken in dit pakket:

- Inlezen van rapportagegegevens van het labo uit het LIMS datawarehouse
- parsen textuurmetingen uit de output van het laserdiffractietoestel 
- Kwaliteitskenmerken digital droplet PCR voor het genetisch labo

Daarnaast zijn er ook nog enkele andere voorzieningen toegevoegd zoals inlezen van textuurdata en verwerken van gegevens.

# Gegevens uit het LIMS Datawarehouse halen

## Eerste gebruik

Iedere keer R opnieuw opgestart wordt zal je de inbolims library moeten laden

```{r}
library(inbolims)
```

De belangrijkste functionaliteit in het script is de connectie met de databank en het ophalen van gegevens van een project. Dit doe je als volgt:

```{r}
#maak connectie met databank
connection <- lims_connect()

#haal de rapportgegevens binnen uit de databank
rapport_data <- read_lims_data(connection = connection,
                               project = c("I-19W001-02"),
                               sql_template = "default",
                               show_query = FALSE)
```
Bovenstaande code haalt de data op voor het project I-19W001-02 (project = "I-19W001-02") volgens de standaardtemplate  (template = "default") en de query die gebruikt is om het datawarehouse te bevragen wordt getoond (show_query = TRUE). Als eerste variabele moet de databank connectie opgegeven worden, zodat de routine weet waar de gegevens uit gehaald moeten worden.

## Afgeleide routines (work in progress)


### Staaloverzicht

Om een overzicht van de stalen te hebben van de ingelezen rapport_data.

```{r}
staaloverzicht <- lims_report_samples(rapport_data)
head(staaloverzicht)
```

Op dit moment vereist bovenstaande routine nog heel wat velden, daarom dat dit enkel gegarandeerd is te werken met de *default* `sql_template`.

### Kruistabel

Het formaat van `rapport_data` is in een lang dataformaat, waarbij ieder resultaat op een andere regel staat. Vaak is eerder gewenst de resultaten van een staal naast elkaar te zien:

```{r}
kruistabel <- lims_report_xtab(rapport_data)
head(kruistabel)
```

### Exporteren

Bovenstaande kruistabel kan je gemakkelijk naar een door excel leesbaar csv bestand converteren:

```{r}
lims_report_export(kruistabel, path = "test_xtab.csv")
lims_report_export(rapport_data, path = "test.csv")
```
Ook hier op dit moment enkel gegarandeerd voor de "default" `sql_template` gebruikt bij `read_lims_data`.

